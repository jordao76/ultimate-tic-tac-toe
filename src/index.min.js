!function(){function n(t,e,o){function r(u,a){if(!e[u]){if(!t[u]){var c="function"==typeof require&&require;if(!a&&c)return c(u,!0);if(i)return i(u,!0);var s=new Error("Cannot find module '"+u+"'");throw s.code="MODULE_NOT_FOUND",s}var l=e[u]={exports:{}};t[u][0].call(l.exports,function(n){var e=t[u][1][n];return r(e||n)},l,l.exports,n,t,e,o)}return e[u].exports}for(var i="function"==typeof require&&require,u=0;u<o.length;u++)r(o[u]);return r}return n}()({1:[function(n,t,e){var o;o=jQuery,o.fn.highlight=function(){return o(this).each(function(){var n;return n=o(this),o("<div/>").width(n.outerWidth()).height(n.outerHeight()).css({position:"absolute",left:n.offset().left,top:n.offset().top,"background-color":"#ffff77",opacity:.7,"z-index":10}).appendTo("body").fadeOut(1e3).queue(function(){return o(this).remove()})})}},{}],2:[function(n,t,e){var o,r,i,u,a,c,s,l,f,p;o=jQuery,l=n("aye-aye/lib/games/bin-tic-tac-toe"),a=l.X,r=l.O,c=l.decode,u=n("aye-aye/lib/games/ultimate-tic-tac-toe").UltimateTicTacToe,f=n("./spinner"),p=f.showSpinner,s=f.hideSpinner,n("./highlight"),i=n("./web-rtc").RTC,o(function(){var n,t,e,l,f,h,d,y,w,v,m,g,x,b,C,T,P,O,A,S,N;return f=null,d=null,g=function(){var n,t,e,r,i,u,c;for(n=f.nextPlayer===a?"x-playable-tile":"o-playable-tile",u=f.possibleActions(),r=0,i=u.length;r<i;r++)c=u[r],t=c[0],e=c[1],o("#"+t+"\\,"+e).addClass(n);return n},N=function(){return o(".tile").removeClass("x-playable-tile").removeClass("o-playable-tile").removeClass("human-playable-tile").off("click")},y=function(){var n,t,e,r,i,u,c,s,l;for(c=[],n=e=0;e<9;n=++e){for(s=null,u=f.winOn(n),r=0,i=u.length;r<i;r++)t=u[r],s=f.at(n,t),l=s===a?"x-won-tile":"o-won-tile",o("#"+n+"\\,"+t).addClass(l);null!=s?(l=s===a?"x-won-board":"o-won-board",c.push(o("#"+n).addClass(l))):c.push(void 0)}return c},n=function(){var n;return!!f.isTerminal()&&(n=function(){switch(!1){case!f.isWin(a):return"X Wins!";case!f.isWin(r):return"O Wins!";default:return"Draw!"}}(),o("#end-text").text(n),o("#modal-game-over").modal("show"),!0)},b=function(){return c(f.nextPlayer).toLowerCase()},m=function(n){var t,e;return t=n[0],e=n[1],s(),o("#"+t+"\\,"+e).text(b()).highlight(),f=f.play(n),d=n,v()},C=null,x=null,v=function(){var n;return N(),y(),n=f.nextPlayer===a?C:x,n.play()},T={human:function(){return h()},peer:function(){return P()},"starter AI":function(){return t("monte-carlo",500)},"smart AI":function(){return t("minimax",3)}},l=function(){var n;return n=o("#btn-player-x").text(),T[n]()},e=function(){var n;return n=o("#btn-player-o").text(),T[n]()},A=function(){var n,t,e;return t=o("#btn-player-x"),n=o("#btn-player-o"),e=t.text(),t.text(n.text()),n.text(e)},o(".player").on("click",function(){var n,t,e,r,i;if(t=o(this),r=t.data("player-for"),n=o("#btn-player-"+r),i=t.text(),e=n.text(),e!==i)return n.text(i),O()}),h=function(){var t,e;return t=function(n){return parseInt(n,10)},e=function(n){var e;return e=n.match(/(\d),(\d)/),[t(e[1]),t(e[2])]},{setup:function(n){return n()},play:function(){var t;if(!n())return t=g(),o("."+t).addClass("human-playable-tile").on("click",function(){var n,t;return n=o(this),t=e(n.get(0).id),m(t)})}}},t=function(t,e){var o;return null==t&&(t="minimax"),null==e&&(e=3),o=new Worker("src/ai-worker.min.js"),{setup:function(n){return o.onmessage=function(n){return m(n.data.action)},o.postMessage({command:"setup",args:{agentName:t,depth:e}}),n()},play:function(){if(!n())return g(),p(),o.postMessage({command:"play",args:{lastAction:d}})},teardown:function(){return o.terminate()}}},o.fn.enable=function(n){return null==n&&(n=!0),o(this).prop("disabled",!n)},i.greet(),i.ondatachannelopen=function(){var n,t,e;return t=i.isHost?["human","peer"]:["peer","human"],e=t[0],n=t[1],o("#btn-player-x").text(e).enable(!1),o("#btn-player-o").text(n).enable(!1),O()},i.ondisconnected=function(){return o("#btn-player-x").text("human").enable(),o("#btn-player-o").text("smart AI").enable(),O()},P=function(){var t;return t=function(){return i.send("new")},o("#btn-new-game").on("click",t),i.onmessage=function(n){return"new"===n?w():m(n)},{setup:function(n){return n()},play:function(){if(n()||(g(),p()),null!=d)return i.send(d)},teardown:function(){return o("#btn-new-game").off("click",t)}}},O=function(){var n;return S(),f=new u,f.lastPlayedPosition=null,d=null,n=[l(),e()],C=n[0],x=n[1],C.setup(function(){return x.setup(function(){return v()})})},S=function(){return null!=C&&"function"==typeof C.teardown&&C.teardown(),null!=x&&"function"==typeof x.teardown&&x.teardown(),s(),o(".tic-tac-toe").removeClass("x-won-board").removeClass("o-won-board"),o(".tile").removeClass("x-won-tile").removeClass("o-won-tile").text("")},w=function(){return A(),O()},o("#btn-new-game").on("click",w),O()})},{"./highlight":1,"./spinner":3,"./web-rtc":4,"aye-aye/lib/games/bin-tic-tac-toe":6,"aye-aye/lib/games/ultimate-tic-tac-toe":7}],3:[function(n,t,e){var o,r,i,u,a,c;o=jQuery,u=new Spinner({lines:9,radius:7,length:7}),c=null,a=100,i=function(){var n;if(null==c)return n=o("#spinner").get(0),c=setTimeout(function(){return u.spin(n)},a)},r=function(){return null!=c&&clearTimeout(c),u.stop(),c=null},t.exports={showSpinner:i,hideSpinner:r}},{}],4:[function(n,t,e){var o,r,i,u,a,c,s;u=window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection||window.msRTCPeerConnection,a=window.RTCSessionDescription||window.mozRTCSessionDescription||window.webkitRTCSessionDescription||window.msRTCSessionDescription,c={iceServers:[{url:"stun:23.21.150.121"}]},s={optional:[{DtlsSrtpKeyAgreement:!0}]},r=function(){function n(){this.peerConnection=new u(c,s),this.dataChannel=null,this.peerConnection.onicecandidate=function(n){return function(t){if(null===t.candidate)return n.onoffercreated(JSON.stringify(n.peerConnection.localDescription))}}(this)}return n.prototype.setupDataChannel=function(){return this.dataChannel=this.peerConnection.createDataChannel("data",{reliable:!0}),this.dataChannel.onopen=function(n){return function(){return n.peerConnection.oniceconnectionstatechange=function(){if("disconnected"===n.peerConnection.iceConnectionState)return"function"==typeof n.ondisconnected?n.ondisconnected():void 0},n.onchannelopen()}}(this),this.dataChannel.onmessage=function(n){return function(t){return n.onmessage(JSON.parse(t.data))}}(this)},n.prototype.createOffer=function(){return this.setupDataChannel(),this.peerConnection.createOffer(function(n){return function(t){return n.peerConnection.setLocalDescription(t)}}(this),function(){return console.warn("Couldn't create offer")})},n.prototype.acceptAnswer=function(n){return this.peerConnection.setRemoteDescription(new a(JSON.parse(n)))},n.prototype.send=function(n){return this.dataChannel.send(JSON.stringify(n))},n}(),o=function(){function n(){this.peerConnection=new u(c,s),this.dataChannel=null,this.peerConnection.onicecandidate=function(n){return function(t){if(null===t.candidate)return n.onanswercreated(JSON.stringify(n.peerConnection.localDescription))}}(this),this.peerConnection.ondatachannel=function(n){return function(t){return n.dataChannel=t.channel||t,n.dataChannel.onopen=function(){return n.peerConnection.oniceconnectionstatechange=function(){if("disconnected"===n.peerConnection.iceConnectionState)return"function"==typeof n.ondisconnected?n.ondisconnected():void 0},n.onchannelopen()},n.dataChannel.onmessage=function(t){return n.onmessage(JSON.parse(t.data))}}}(this)}return n.prototype.offer=function(n){return this.peerConnection.setRemoteDescription(new a(JSON.parse(n))),this.peerConnection.createAnswer(function(n){return function(t){return n.peerConnection.setLocalDescription(t)}}(this),function(){return console.warn("Couldn't create answer")})},n.prototype.send=function(n){return this.dataChannel.send(JSON.stringify(n))},n}(),t.exports={Host:r,Guest:o},i={greet:function(){return window.RTC=i,console.log("To play with a remote peer, start a match with %cRTC.host()","background: #222; color: #bada55")},host:function(){var n,t,e;return this.isHost=!0,t=new r,e=99999*Math.random()+1e4|0,n=new Firebase("https://ut3.firebaseio.com/"+e),t.onoffercreated=function(o){return n.onDisconnect().remove(),n.set({offer:JSON.parse(o)}),window.location.hash=e,console.log("Give this URL to the other player:"),console.log(window.location.href),n.on("value",function(n){var e;if(e=n.val(),null!=(null!=e?e.answer:void 0))return t.acceptAnswer(JSON.stringify(e.answer))})},t.ondisconnected=function(){return console.log("peer disconnected!"),window.location.hash="","function"==typeof i.ondisconnected?i.ondisconnected():void 0},t.onchannelopen=function(){return console.log("channel open"),i.send=function(n){return t.send(n)},n.off("value"),"function"==typeof i.ondatachannelopen?i.ondatachannelopen():void 0},t.onmessage=function(n){return console.log("HOST: got data",n),"function"==typeof i.onmessage?i.onmessage(n):void 0},t.createOffer()},guest:function(){var n,t,e;if(e=window.location.hash)return this.isGuest=!0,n=new Firebase("https://ut3.firebaseio.com/"+e.substring(1)),t=new o,t.onanswercreated=function(t){return n.update({answer:JSON.parse(t)})},t.ondisconnected=function(){return console.log("peer disconnected!"),window.location.hash="","function"==typeof i.ondisconnected?i.ondisconnected():void 0},t.onchannelopen=function(){return console.log("channel open"),i.send=function(n){return t.send(n)},"function"==typeof i.ondatachannelopen?i.ondatachannelopen():void 0},t.onmessage=function(n){return console.log("GUEST: got data",n),"function"==typeof i.onmessage?i.onmessage(n):void 0},n.once("value",function(n){var o;return o=n.val(),null!=(null!=o?o.offer:void 0)?t.offer(JSON.stringify(o.offer)):(console.log("HOST offer not found for game "+e),window.location.hash="")})}},jQuery(function(){return i.guest()}),t.exports.RTC=i},{}],5:[function(n,t,e){var o,r,i;i=[1,2],o=i[0],r=i[1],t.exports={P1:o,P2:r}},{}],6:[function(n,t,e){var o,r,i,u,a,c,s,l,f,p,h,d,y,w,v,m,g,x,b,C,T,P,O,A,S,N,M,D,R,W,k,J=[].slice;N=n("../minimax"),r=N.MAX,i=N.MIN,M=[0,1,2],c=M[0],a=M[1],u=M[2],A=function(n){return 3&~n},d=function(n){return{0:" ",1:"X",2:"O"}[n]||function(){throw new Error(n)}()},v=0,f=function(n){var t,e,o,r,i;for(i=0,e=o=0,r=n.length;o<r;e=++o)t=n[e],i|=t<<2*e;return i},l=function(n,t){return n>>2*t&3},D=function(n){return[[l(n,0),l(n,1),l(n,2)],[l(n,3),l(n,4),l(n,5)],[l(n,6),l(n,7),l(n,8)]]},h=function(n){return[[l(n,0),l(n,3),l(n,6)],[l(n,1),l(n,4),l(n,7)],[l(n,2),l(n,5),l(n,8)]]},y=function(n){return[[l(n,0),l(n,4),l(n,8)],[l(n,2),l(n,4),l(n,6)]]},T=function(n){return J.call(D(n)).concat(J.call(h(n)),J.call(y(n)))},x=function(n){var t,e;for(t=e=0;e<18;t=e+=2)if(0===(3<<t&n))return!1;return!0},P={1:[21,1344,86016,4161,16644,66576,65793,4368],2:[42,2688,172032,8322,33288,133152,131586,8736]},S=[[0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[2,4,6]],C=function(n,t){var e,o,r,i;for(i=P[t]||function(){throw new Error(t)}(),e=0,o=i.length;e<o;e++)if(r=i[e],(r&n)===r)return!0;return!1},W=function(n){var t;return t=function(t){var e,o,r,i,u;for(u=P[t],e=o=0,r=u.length;o<r;e=++o)if(i=u[e],(i&n)===i)return S[e];return null},t(a)||t(u)||[]},b=function(n){return x(n)||C(n,a)||C(n,u)},O=function(n){var t,e,o;for(o=[],t=e=0;e<9;t=++e)0===(3<<2*t&n)&&o.push(t);return o},s=function(n,t){var e,o,r;for(r=[],e=o=0;o<18;e=o+=2)0===(3<<e&n)&&r.push(t<<e|n);return r},p=function(n,t){var e,o;for(e=o=0;o<18;e=++o)if((3<<2*e&n)!==(3<<2*e&t))return e;return null},k=.1,w=function(n,t){return null==t&&(t=0),Math.pow(k,t)*R(n)},R=function(n){return C(n,a)?2e3:C(n,u)?-2e3:x(n)?0:m(n)},g={},m=function(n){var t,e,o,r,i,c,s,l,f,p,h;if(null!=g[n])return g[n];for(f=0,s=T(n),t=0,r=s.length;t<r;t++){for(o=s[t],l=[0,0],h=l[0],c=l[1],e=0,i=o.length;e<i;e++)p=o[e],p===a&&++h,p===u&&++c;0!==h&&0!==c||(f+=Math.pow(10,h)-Math.pow(10,c))}return g[n]=f},o=function(){function n(n,t,e){this.value=null!=n?n:v,this.nextPlayer=null!=t?t:a,this.depth=null!=e?e:0}return n.create=function(){var t,e;return t=arguments[0],e=2<=arguments.length?J.call(arguments,1):[],null==t&&(t=[c,c,c,c,c,c,c,c,c]),function(n,t,e){e.prototype=n.prototype;var o=new e,r=n.apply(o,t);return Object(r)===r?r:o}(n,[f(t)].concat(J.call(e)),function(){})},n.prototype.at=function(n){return l(this.value,n)},n.prototype.rows=function(){return D(this.value)},n.prototype.columns=function(){return h(this.value)},n.prototype.diagonals=function(){return y(this.value)},n.prototype.lines=function(){return T(this.value)},n.prototype.isFull=function(){return x(this.value)},n.prototype.isWin=function(n){return C(this.value,n)},n.prototype.winner=function(){switch(!1){case!this.isWin(a):return a;case!this.isWin(u):return u;default:return null}},n.prototype.winOn=function(){return W(this.value)},n.prototype.isTerminal=function(){return b(this.value)},n.prototype.nextAgent=function(){return this.nextPlayer===a?r:i},n.prototype.openPositions=function(){return O(this.value)},n.prototype.possibleActions=function(){return s(this.value,this.nextPlayer)},n.prototype.action=function(n){return this.nextPlayer<<2*n|this.value},n.prototype.positionForAction=function(n){return p(this.value,n)},n.prototype.play=function(n){return new this.constructor(n,this.opponent(),this.depth+1)},n.prototype.utility=function(){return R(this.value)},n.prototype.opponent=function(n){return null==n&&(n=this.nextPlayer),A(n)},n.prototype.toString=function(){var n,t;return function(){var e,o,r,i;for(r=this.rows(),i=[],e=0,o=r.length;e<o;e++)t=r[e],i.push("|"+function(){var e,o,r;for(r=[],e=0,o=t.length;e<o;e++)n=t[e],r.push(d(n));return r}().join("|")+"|");return i}.call(this).join("\n")},n}(),t.exports={_:c,X:a,O:u,opponent:A,decode:d,empty:v,bin:f,at:l,rows:D,columns:h,diagonals:y,lines:T,isFull:x,isWin:C,isTerminal:b,openPositions:O,allPlays:s,changedOn:p,winOn:W,discountedUtility:w,utility:R,evaluate:m,BinTicTacToe:o}},{"../minimax":8}],7:[function(n,t,e){var o,r,i,u,a,c,s,l,f,p,h,d,y,w,v,m,g,x,b,C,T,P,O,A,S,N,M,D,R=[].slice;O=n("../minimax"),r=O.MAX,i=O.MIN,A=n("./bin-tic-tac-toe"),s=A._,c=A.X,u=A.O,d=A.decode,m=A.empty,f=A.bin,l=A.at,S=A.rows,p=A.columns,y=A.diagonals,T=A.lines,b=A.isWin,D=A.winOn,x=A.isTerminal,g=A.evaluate,o=A.BinTicTacToe,v=m,M=[v,v,v,v,v,v,v,v,v],N=function(n){var t,e,o,r;for(r=[],t=e=0,o=9;e<o;t=e+=3)r.push(n.slice(t,t+3));return r},h=function(n){var t,e,o;for(o=[],t=e=0;e<3;t=++e)o.push([n[t],n[t+3],n[t+6]]);return o},w=function(n){return[[n[0],n[4],n[8]],[n[2],n[4],n[6]]]},P=function(n){return R.call(N(n)).concat(R.call(h(n)),R.call(w(n)))},C=function(n,t){var e,o,r,i;for(i=P(n),r=0,o=i.length;r<o;r++)if(e=i[r],e.every(function(n){return b(n,t)}))return!0;return!1},a=function(){function n(n,t,e,o){this.a=null!=n?n:M,this.nextPlayer=null!=t?t:c,this.lastPlayedPosition=null!=e?e:4,this.depth=null!=o?o:0}return n.prototype.at=function(n,t){return l(this.a[n],t)},n.prototype.rows=function(){return N(this.a)},n.prototype.columns=function(){return h(this.a)},n.prototype.diagonals=function(){return w(this.a)},n.prototype.lines=function(){return P(this.a)},n.prototype.isTerminal=function(){return 0===this.possibleActions().length||this.isWin(c)||this.isWin(u)},n.prototype.winner=function(){switch(!1){case!this.isWin(c):return c;case!this.isWin(u):return u;default:return null}},n.prototype.isWin=function(n){return C(this.a,n)},n.prototype.winOn=function(n){return D(this.a[n])},n.prototype.nextAgent=function(){return this.nextPlayer===c?r:i},n.prototype.opponent=function(n){return null==n&&(n=this.nextPlayer),n===c?u:c},n.prototype.boardsForNextPlay=function(){var n,t,e,o,r,i;if(i=null!=this.lastPlayedPosition?this.a[this.lastPlayedPosition]:null,null==i||x(i)){for(r=[],o=this.a,n=e=0,t=o.length;e<t;n=++e)i=o[n],x(i)||r.push(n);return r}return[this.lastPlayedPosition]},n.prototype.openPositions=function(){var n,t,e,o,r,i,u,a,c;for(a=[],u=this.boardsForNextPlay(),r=0,o=u.length;r<o;r++){for(n=u[r],c=this.a[n],e=[],t=i=0;i<18;t=i+=2)0===(3<<t&c)&&e.push(t/2);a.push([n,e])}return a},n.prototype.action=function(n){return n},n.prototype.possibleActions=function(){var n,t,e,o,r,i,u,a,c,s;if(null!=this.actions)return this.actions;for(s=[],a=this.openPositions(),i=0,o=a.length;i<o;i++)for(c=a[i],n=c[0],e=c[1],u=0,r=e.length;u<r;u++)t=e[u],s.push([n,t]);return this.actions=s},n.prototype.play=function(n){var t,e,o;return e=n[0],o=n[1],t=this.a.slice(),t[e]=this.nextPlayer<<2*o|t[e],new this.constructor(t,this.opponent(),o,this.depth+1)},n.prototype.positionForAction=function(n){return n},n.prototype.utility=function(){var n,t,e,o,r,i,a,s,l,f,p,h;for(p=0,l=P(this.a),a=0,r=l.length;a<r;a++){for(o=l[a],f=[0,0,0],n=f[0],t=f[1],e=f[2],s=0,i=o.length;s<i;s++)h=o[s],b(h,c)?++n:b(h,u)&&++t,e+=g(h);0!==n&&0!==t||(p+=Math.pow(1e3,n)-Math.pow(1e3,t)),p+=e}return p},n.prototype.toString=function(){var n,t,e,o,r,i,u,a;for(r="",n=t=0;t<=2;n=++t){for(a=this.rows()[n],o=e=0;e<=2;o=++e)i=function(){var n,t,e;for(e=[],t=0,n=a.length;t<n;t++)u=a[t],e.push("|"+function(){var n,t,e,r;for(e=S(u)[o],r=[],t=0,n=e.length;t<n;t++)v=e[t],r.push(d(v));return r}().join("|")+"|");return e}(),r+=i.join(" ║ "),(n<2||o<2)&&(r+="\n");n<2&&(r+="════════╬═════════╬════════\n")}return r},n}(),t.exports={_:s,X:c,O:u,bin:f,UltimateTicTacToe:a}},{"../minimax":8,"./bin-tic-tac-toe":6}],8:[function(n,t,e){var o,r,i,u,a,c,s,l;s=n("./game"),a=s.P1,c=s.P2,l=[a,c],r=l[0],i=l[1],o=Number.MAX_SAFE_INTEGER,u=function(){function n(n){this.depth=null!=n?n:o,this.rootAgent=r}return n.prototype.nextAction=function(n){var t,e,o;return this.rootAgent=n.nextAgent(),o=this.minimax(n),t=o[0],e=o[1],e},n.prototype.minimax=function(n,t,e,i){var u;return null==t&&(t=-o),null==e&&(e=+o),null==i&&(i=0),u=n.isTerminal(),u||n.nextAgent()!==this.rootAgent||++i,i>this.depth||u?[n.utility(),null]:n.nextAgent()===r?this.maxi(n,t,e,i):this.mini(n,t,e,i)},n.prototype.maxi=function(n,t,e,r){var i,u,a,c,s,l,f,p,h,d,y,w;for(f=[-o,null],w=f[0],u=f[1],p=n.possibleActions(),c=0,s=p.length;c<s;c++){if(a=p[c],y=n.play(a),h=this.minimax(y,t,e,r),l=h[0],i=h[1],l>w&&(d=[l,a],w=d[0],u=d[1]),w>=e)return[w,u];t=Math.max(t,w)}return[w,u]},n.prototype.mini=function(n,t,e,r){var i,u,a,c,s,l,f,p,h,d,y,w;for(f=[+o,null],w=f[0],u=f[1],p=n.possibleActions(),c=0,s=p.length;c<s;c++){if(a=p[c],y=n.play(a),h=this.minimax(y,t,e,r),l=h[0],i=h[1],l<w&&(d=[l,a],w=d[0],u=d[1]),w<=t)return[w,u];e=Math.min(e,w)}return[w,u]},n}(),t.exports={MAX:r,MIN:i,Limit:o,MinimaxAgent:u}},{"./game":5}]},{},[2]);
//# sourceMappingURL=index.min.js.map
