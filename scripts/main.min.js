!function n(t,e,o){function r(u,a){if(!e[u]){if(!t[u]){var c="function"==typeof require&&require;if(!a&&c)return c(u,!0);if(i)return i(u,!0);var s=new Error("Cannot find module '"+u+"'");throw s.code="MODULE_NOT_FOUND",s}var l=e[u]={exports:{}};t[u][0].call(l.exports,function(n){var e=t[u][1][n];return r(e?e:n)},l,l.exports,n,t,e,o)}return e[u].exports}for(var i="function"==typeof require&&require,u=0;u<o.length;u++)r(o[u]);return r}({1:[function(n,t,e){var o;o=jQuery,o.fn.highlight=function(){return o(this).each(function(){var n;return n=o(this),o("<div/>").width(n.outerWidth()).height(n.outerHeight()).css({position:"absolute",left:n.offset().left,top:n.offset().top,"background-color":"#ffff77",opacity:.7,"z-index":10}).appendTo("body").fadeOut(1e3).queue(function(){return o(this).remove()})})}},{}],2:[function(n,t,e){var o,r,i,u,a,c,s,l,f,p;o=jQuery,l=n("aye-aye/lib/games/bin-tic-tac-toe"),a=l.X,r=l.O,c=l.decode,u=n("aye-aye/lib/games/ultimate-tic-tac-toe").UltimateTicTacToe,f=n("./spinner"),p=f.showSpinner,s=f.hideSpinner,n("./highlight"),i=n("./web-rtc").RTC,window.RTC=i,o(function(){var n,t,e,l,f,h,d,y,v,g,w,m,C,x,b,T,O,S,P;return f=null,x=null,m=null,d=null,l=null,e=null,O=function(){return l=function(){return h()},e=function(){return t()}},O(),v=function(){var n;return P(),y(),n=f.nextPlayer===a?x:m,n.play()},w=function(){var n,t,e,r,i,u,c;for(n=f.nextPlayer===a?"x-playable-tile":"o-playable-tile",u=f.possibleActions(),r=0,i=u.length;i>r;r++)c=u[r],t=c[0],e=c[1],o("#"+t+"\\,"+e).addClass(n);return n},P=function(){return o(".tile").removeClass("x-playable-tile").removeClass("o-playable-tile").removeClass("human-playable-tile").off("click")},y=function(){var n,t,e,r,i,u,c,s,l;for(c=[],n=e=0;9>e;n=++e){for(s=null,u=f.winOn(n),r=0,i=u.length;i>r;r++)t=u[r],s=f.at(n,t),l=s===a?"x-won-tile":"o-won-tile",o("#"+n+"\\,"+t).addClass(l);null!=s?(l=s===a?"x-won-board":"o-won-board",c.push(o("#"+n).addClass(l))):c.push(void 0)}return c},n=function(){return f.isTerminal()?(o("#info").text(function(){switch(!1){case!f.isWin(a):return"X Wins!";case!f.isWin(r):return"O Wins!";default:return"Draw!"}}()),!0):!1},C=function(){return c(f.nextPlayer).toLowerCase()},g=function(n){var t,e;return t=n[0],e=n[1],s(),o("#"+t+"\\,"+e).text(C()).highlight(),f=f.play(n),d=n,v()},h=function(){var t,e;return t=function(n){return parseInt(n,10)},e=function(n){var e;return e=n.match(/(\d),(\d)/),[t(e[1]),t(e[2])]},{setup:function(n){return n()},play:function(){var t;if(!n())return t=w(),o("."+t).addClass("human-playable-tile").on("click",function(){var n,t;return n=o(this),t=e(n.get(0).id),g(t)})},toString:function(){return"human"}}},t=function(t){var e;return null==t&&(t=3),e=new Worker("scripts/minimax-worker.min.js"),{setup:function(n){return e.onmessage=function(n){return g(n.data.action)},e.postMessage({command:"setup",args:{depth:t}}),n()},play:function(){return n()?void 0:(w(),p(),e.postMessage({command:"play",args:{lastAction:d}}))},teardown:function(){return e.terminate()},toString:function(){return"computer"}}},i.greet(),i.ondatachannelopen=function(){return i.isHost?(l=function(){return h()},e=function(){return b()}):(l=function(){return b()},e=function(){return h()}),T()},i.ondisconnected=function(){return O(),T()},b=function(){var t;return t=function(){return i.send("new")},o("#btn-new-game").on("click",t),i.onmessage=function(n){return"new"===n?T():g(n)},{setup:function(n){return n()},play:function(){return n()||(w(),p()),null!=d?i.send(d):void 0},teardown:function(){return o("#btn-new-game").off("click",t)},toString:function(){return"remote"}}},T=function(){var n,t;return S(),f=new u,d=null,n=[l(),e()],x=n[0],m=n[1],t=[e,l],l=t[0],e=t[1],o("#info").text(x+" vs "+m),x.setup(function(){return m.setup(function(){return v()})})},S=function(){return null!=x&&"function"==typeof x.teardown&&x.teardown(),null!=m&&"function"==typeof m.teardown&&m.teardown(),s(),o(".tic-tac-toe").removeClass("x-won-board").removeClass("o-won-board"),o(".tile").removeClass("x-won-tile").removeClass("o-won-tile").text("")},o("#btn-new-game").on("click",T),T()})},{"./highlight":1,"./spinner":3,"./web-rtc":4,"aye-aye/lib/games/bin-tic-tac-toe":5,"aye-aye/lib/games/ultimate-tic-tac-toe":6}],3:[function(n,t,e){var o,r,i,u,a,c;o=jQuery,u=new Spinner({lines:9,radius:7,length:7}),c=null,a=100,i=function(){var n;return null==c?(n=o("#spinner").get(0),c=setTimeout(function(){return u.spin(n)},a)):void 0},r=function(){return null!=c&&clearTimeout(c),u.stop(),c=null},t.exports={showSpinner:i,hideSpinner:r}},{}],4:[function(n,t,e){var o,r,i,u,a,c,s;u=window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection||window.msRTCPeerConnection,a=window.RTCSessionDescription||window.mozRTCSessionDescription||window.webkitRTCSessionDescription||window.msRTCSessionDescription,c={iceServers:[{url:"stun:23.21.150.121"}]},s={optional:[{DtlsSrtpKeyAgreement:!0}]},r=function(){function n(){this.peerConnection=new u(c,s),this.dataChannel=null,this.peerConnection.onicecandidate=function(n){return function(t){return null===t.candidate?n.onoffercreated(JSON.stringify(n.peerConnection.localDescription)):void 0}}(this)}return n.prototype.setupDataChannel=function(){return this.dataChannel=this.peerConnection.createDataChannel("data",{reliable:!0}),this.dataChannel.onopen=function(n){return function(){return n.peerConnection.oniceconnectionstatechange=function(){return"disconnected"===n.peerConnection.iceConnectionState&&"function"==typeof n.ondisconnected?n.ondisconnected():void 0},n.onchannelopen()}}(this),this.dataChannel.onmessage=function(n){return function(t){return n.onmessage(JSON.parse(t.data))}}(this)},n.prototype.createOffer=function(){return this.setupDataChannel(),this.peerConnection.createOffer(function(n){return function(t){return n.peerConnection.setLocalDescription(t)}}(this),function(){return console.warn("Couldn't create offer")})},n.prototype.acceptAnswer=function(n){return this.peerConnection.setRemoteDescription(new a(JSON.parse(n)))},n.prototype.send=function(n){return this.dataChannel.send(JSON.stringify(n))},n}(),o=function(){function n(){this.peerConnection=new u(c,s),this.dataChannel=null,this.peerConnection.onicecandidate=function(n){return function(t){return null===t.candidate?n.onanswercreated(JSON.stringify(n.peerConnection.localDescription)):void 0}}(this),this.peerConnection.ondatachannel=function(n){return function(t){return n.dataChannel=t.channel||t,n.dataChannel.onopen=function(){return n.peerConnection.oniceconnectionstatechange=function(){return"disconnected"===n.peerConnection.iceConnectionState&&"function"==typeof n.ondisconnected?n.ondisconnected():void 0},n.onchannelopen()},n.dataChannel.onmessage=function(t){return n.onmessage(JSON.parse(t.data))}}}(this)}return n.prototype.offer=function(n){return this.peerConnection.setRemoteDescription(new a(JSON.parse(n))),this.peerConnection.createAnswer(function(n){return function(t){return n.peerConnection.setLocalDescription(t)}}(this),function(){return console.warn("Couldn't create answer")})},n.prototype.send=function(n){return this.dataChannel.send(JSON.stringify(n))},n}(),t.exports={Host:r,Guest:o},i={greet:function(){return console.log("To play with a remote peer, start a match with %cRTC.host()","background: #222; color: #bada55")},host:function(){var n,t,e;return this.isHost=!0,t=new r,e=99999*Math.random()+1e4|0,n=new Firebase("https://ut3.firebaseio.com/"+e),t.onoffercreated=function(o){return n.onDisconnect().remove(),n.set({offer:JSON.parse(o)}),window.location.hash=e,console.log("Give this URL to the other player:"),console.log(window.location.href),n.on("value",function(n){var e;return e=n.val(),null!=(null!=e?e.answer:void 0)?t.acceptAnswer(JSON.stringify(e.answer)):void 0})},t.ondisconnected=function(){return console.log("peer disconnected!"),window.location.hash="","function"==typeof i.ondisconnected?i.ondisconnected():void 0},t.onchannelopen=function(){return console.log("channel open"),i.send=function(n){return t.send(n)},n.off("value"),"function"==typeof i.ondatachannelopen?i.ondatachannelopen():void 0},t.onmessage=function(n){return console.log("HOST: got data",n),"function"==typeof i.onmessage?i.onmessage(n):void 0},t.createOffer()},guest:function(){var n,t,e;return(e=window.location.hash)?(this.isGuest=!0,n=new Firebase("https://ut3.firebaseio.com/"+e.substring(1)),t=new o,t.onanswercreated=function(t){return n.update({answer:JSON.parse(t)})},t.ondisconnected=function(){return console.log("peer disconnected!"),window.location.hash="","function"==typeof i.ondisconnected?i.ondisconnected():void 0},t.onchannelopen=function(){return console.log("channel open"),i.send=function(n){return t.send(n)},"function"==typeof i.ondatachannelopen?i.ondatachannelopen():void 0},t.onmessage=function(n){return console.log("GUEST: got data",n),"function"==typeof i.onmessage?i.onmessage(n):void 0},n.once("value",function(n){var o;return o=n.val(),null!=(null!=o?o.offer:void 0)?t.offer(JSON.stringify(o.offer)):(console.log("HOST offer not found for game "+e),window.location.hash="")})):void 0}},jQuery(function(){return i.guest()}),t.exports.RTC=i},{}],5:[function(n,t,e){var o,r,i,u,a,c,s,l,f,p,h,d,y,v,g,w,m,C,x,b,T,O,S,P,A,M,N,D,R,J,W,k=[].slice;M=n("../minimax"),r=M.MAX,i=M.MIN,N=[0,1,2],c=N[0],a=N[1],u=N[2],P=function(n){return 3&~n},d=function(n){return{0:" ",1:"X",2:"O"}[n]||function(){throw new Error(n)}()},g=0,f=function(n){var t,e,o,r,i;for(i=0,e=o=0,r=n.length;r>o;e=++o)t=n[e],i|=t<<2*e;return i},l=function(n,t){return n>>2*t&3},D=function(n){return[[l(n,0),l(n,1),l(n,2)],[l(n,3),l(n,4),l(n,5)],[l(n,6),l(n,7),l(n,8)]]},h=function(n){return[[l(n,0),l(n,3),l(n,6)],[l(n,1),l(n,4),l(n,7)],[l(n,2),l(n,5),l(n,8)]]},y=function(n){return[[l(n,0),l(n,4),l(n,8)],[l(n,2),l(n,4),l(n,6)]]},T=function(n){return k.call(D(n)).concat(k.call(h(n)),k.call(y(n)))},C=function(n){var t,e;for(t=e=0;18>e;t=e+=2)if(0===(3<<t&n))return!1;return!0},O={1:[21,1344,86016,4161,16644,66576,65793,4368],2:[42,2688,172032,8322,33288,133152,131586,8736]},A=[[0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[2,4,6]],b=function(n,t){var e,o,r,i;for(i=O[t]||function(){throw new Error(t)}(),e=0,o=i.length;o>e;e++)if(r=i[e],(r&n)===r)return!0;return!1},J=function(n){var t;return t=function(t){var e,o,r,i,u;for(u=O[t],e=o=0,r=u.length;r>o;e=++o)if(i=u[e],(i&n)===i)return A[e];return null},t(a)||t(u)||[]},x=function(n){return C(n)||b(n,a)||b(n,u)},S=function(n){var t,e,o;for(o=[],t=e=0;9>e;t=++e)0===(3<<2*t&n)&&o.push(t);return o},s=function(n,t){var e,o,r;for(r=[],e=o=0;18>o;e=o+=2)0===(3<<e&n)&&r.push(t<<e|n);return r},p=function(n,t){var e,o;for(e=o=0;18>o;e=++o)if((3<<2*e&n)!==(3<<2*e&t))return e;return null},W=.1,v=function(n,t){return null==t&&(t=0),Math.pow(W,t)*R(n)},R=function(n){return b(n,a)?2e3:b(n,u)?-2e3:C(n)?0:w(n)},m={},w=function(n){var t,e,o,r,i,c,s,l,f,p,h;if(null!=m[n])return m[n];for(f=0,s=T(n),t=0,r=s.length;r>t;t++){for(o=s[t],l=[0,0],h=l[0],c=l[1],e=0,i=o.length;i>e;e++)p=o[e],p===a&&++h,p===u&&++c;(0===h||0===c)&&(f+=Math.pow(10,h)-Math.pow(10,c))}return m[n]=f},o=function(){function n(n,t,e){this.value=null!=n?n:g,this.nextPlayer=null!=t?t:a,this.depth=null!=e?e:0}return n.create=function(){var t,e;return t=arguments[0],e=2<=arguments.length?k.call(arguments,1):[],null==t&&(t=[c,c,c,c,c,c,c,c,c]),function(n,t,e){e.prototype=n.prototype;var o=new e,r=n.apply(o,t);return Object(r)===r?r:o}(n,[f(t)].concat(k.call(e)),function(){})},n.prototype.at=function(n){return l(this.value,n)},n.prototype.rows=function(){return D(this.value)},n.prototype.columns=function(){return h(this.value)},n.prototype.diagonals=function(){return y(this.value)},n.prototype.lines=function(){return T(this.value)},n.prototype.isFull=function(){return C(this.value)},n.prototype.isWin=function(n){return b(this.value,n)},n.prototype.winOn=function(){return J(this.value)},n.prototype.isTerminal=function(){return x(this.value)},n.prototype.nextAgent=function(){return this.nextPlayer===a?r:i},n.prototype.openPositions=function(){return S(this.value)},n.prototype.possibleActions=function(){return s(this.value,this.nextPlayer)},n.prototype.action=function(n){return this.nextPlayer<<2*n|this.value},n.prototype.positionForAction=function(n){return p(this.value,n)},n.prototype.play=function(n){return new this.constructor(n,this.opponent(),this.depth+1)},n.prototype.utility=function(){return R(this.value)},n.prototype.opponent=function(n){return null==n&&(n=this.nextPlayer),P(n)},n.prototype.toString=function(){var n,t;return function(){var e,o,r,i;for(r=this.rows(),i=[],e=0,o=r.length;o>e;e++)t=r[e],i.push("|"+function(){var e,o,r;for(r=[],e=0,o=t.length;o>e;e++)n=t[e],r.push(d(n));return r}().join("|")+"|");return i}.call(this).join("\n")},n}(),t.exports={_:c,X:a,O:u,opponent:P,decode:d,empty:g,bin:f,at:l,rows:D,columns:h,diagonals:y,lines:T,isFull:C,isWin:b,isTerminal:x,openPositions:S,allPlays:s,changedOn:p,winOn:J,discountedUtility:v,utility:R,evaluate:w,BinTicTacToe:o}},{"../minimax":7}],6:[function(n,t,e){var o,r,i,u,a,c,s,l,f,p,h,d,y,v,g,w,m,C,x,b,T,O,S,P,A,M,N,D,R=[].slice;S=n("../minimax"),r=S.MAX,i=S.MIN,P=n("./bin-tic-tac-toe"),s=P._,c=P.X,u=P.O,d=P.decode,w=P.empty,f=P.bin,l=P.at,A=P.rows,p=P.columns,y=P.diagonals,T=P.lines,x=P.isWin,D=P.winOn,C=P.isTerminal,m=P.evaluate,o=P.BinTicTacToe,g=w,N=[g,g,g,g,g,g,g,g,g],M=function(n){var t,e,o,r;for(r=[],t=e=0,o=9;o>e;t=e+=3)r.push(n.slice(t,t+3));return r},h=function(n){var t,e,o;for(o=[],t=e=0;3>e;t=++e)o.push([n[t],n[t+3],n[t+6]]);return o},v=function(n){return[[n[0],n[4],n[8]],[n[2],n[4],n[6]]]},O=function(n){return R.call(M(n)).concat(R.call(h(n)),R.call(v(n)))},b=function(n,t){var e,o,r,i;for(i=O(n),r=0,o=i.length;o>r;r++)if(e=i[r],e.every(function(n){return x(n,t)}))return!0;return!1},a=function(){function n(n,t,e,o){this.a=null!=n?n:N,this.nextPlayer=null!=t?t:c,this.lastPlayedPosition=null!=e?e:4,this.depth=null!=o?o:0}return n.prototype.at=function(n,t){return l(this.a[n],t)},n.prototype.rows=function(){return M(this.a)},n.prototype.columns=function(){return h(this.a)},n.prototype.diagonals=function(){return v(this.a)},n.prototype.lines=function(){return O(this.a)},n.prototype.isTerminal=function(){return 0===this.possibleActions().length||this.isWin(c)||this.isWin(u)},n.prototype.isWin=function(n){return b(this.a,n)},n.prototype.winOn=function(n){return D(this.a[n])},n.prototype.nextAgent=function(){return this.nextPlayer===c?r:i},n.prototype.opponent=function(n){return null==n&&(n=this.nextPlayer),n===c?u:c},n.prototype.boardsForNextPlay=function(){var n,t,e,o,r,i;if(i=null!=this.lastPlayedPosition?this.a[this.lastPlayedPosition]:null,null==i||C(i)){for(r=[],o=this.a,n=e=0,t=o.length;t>e;n=++e)i=o[n],C(i)||r.push(n);return r}return[this.lastPlayedPosition]},n.prototype.openPositions=function(){var n,t,e,o,r,i,u,a,c;for(a=[],u=this.boardsForNextPlay(),r=0,o=u.length;o>r;r++){for(n=u[r],c=this.a[n],e=[],t=i=0;18>i;t=i+=2)0===(3<<t&c)&&e.push(t/2);a.push([n,e])}return a},n.prototype.action=function(n){return n},n.prototype.possibleActions=function(){var n,t,e,o,r,i,u,a,c,s;if(null!=this.actions)return this.actions;for(s=[],a=this.openPositions(),i=0,o=a.length;o>i;i++)for(c=a[i],n=c[0],e=c[1],u=0,r=e.length;r>u;u++)t=e[u],s.push([n,t]);return this.actions=s},n.prototype.play=function(n){var t,e,o;return e=n[0],o=n[1],t=this.a.slice(),t[e]=this.nextPlayer<<2*o|t[e],new this.constructor(t,this.opponent(),o,this.depth+1)},n.prototype.positionForAction=function(n){return n},n.prototype.utility=function(){var n,t,e,o,r,i,a,s,l,f,p,h;for(p=0,l=O(this.a),a=0,r=l.length;r>a;a++){for(o=l[a],f=[0,0,0],n=f[0],t=f[1],e=f[2],s=0,i=o.length;i>s;s++)h=o[s],x(h,c)?++n:x(h,u)&&++t,e+=m(h);(0===n||0===t)&&(p+=Math.pow(1e3,n)-Math.pow(1e3,t)),p+=e}return p},n.prototype.toString=function(){var n,t,e,o,r,i,u,a;for(r="",n=t=0;2>=t;n=++t){for(a=this.rows()[n],o=e=0;2>=e;o=++e)i=function(){var n,t,e;for(e=[],t=0,n=a.length;n>t;t++)u=a[t],e.push("|"+function(){var n,t,e,r;for(e=A(u)[o],r=[],t=0,n=e.length;n>t;t++)g=e[t],r.push(d(g));return r}().join("|")+"|");return e}(),r+=i.join(" ║ "),(2>n||2>o)&&(r+="\n");2>n&&(r+="════════╬═════════╬════════\n")}return r},n}(),t.exports={_:s,X:c,O:u,bin:f,UltimateTicTacToe:a}},{"../minimax":7,"./bin-tic-tac-toe":5}],7:[function(n,t,e){var o,r,i,u;u=["MAX","MIN"],o=u[0],r=u[1],i=function(){function n(n){this.depth=null!=n?n:1/0,this.rootAgent=o}return n.prototype.nextAction=function(n){var t,e,o;return this.rootAgent=n.nextAgent(),o=this.minimax(n),t=o[0],e=o[1],e},n.prototype.minimax=function(n,t,e,r){var i;return null==t&&(t=-(1/0)),null==e&&(e=+(1/0)),null==r&&(r=0),i=n.isTerminal(),i||n.nextAgent()!==this.rootAgent||++r,r>this.depth||i?[n.utility(),null]:n.nextAgent()===o?this.maxi(n,t,e,r):this.mini(n,t,e,r)},n.prototype.maxi=function(n,t,e,o){var r,i,u,a,c,s,l,f,p,h,d,y;for(l=[-(1/0),null],y=l[0],i=l[1],f=n.possibleActions(),a=0,c=f.length;c>a;a++){if(u=f[a],d=n.play(u),p=this.minimax(d,t,e,o),s=p[0],r=p[1],s>y&&(h=[s,u],y=h[0],i=h[1]),y>=e)return[y,i];t=Math.max(t,y)}return[y,i]},n.prototype.mini=function(n,t,e,o){var r,i,u,a,c,s,l,f,p,h,d,y;for(l=[+(1/0),null],y=l[0],i=l[1],f=n.possibleActions(),a=0,c=f.length;c>a;a++){if(u=f[a],d=n.play(u),p=this.minimax(d,t,e,o),s=p[0],r=p[1],y>s&&(h=[s,u],y=h[0],i=h[1]),t>=y)return[y,i];e=Math.min(e,y)}return[y,i]},n}(),t.exports={MAX:o,MIN:r,MinimaxAgent:i}},{}]},{},[2]);
//# sourceMappingURL=main.min.js.map
