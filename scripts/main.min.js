!function n(t,e,o){function r(u,a){if(!e[u]){if(!t[u]){var s="function"==typeof require&&require;if(!a&&s)return s(u,!0);if(i)return i(u,!0);var c=new Error("Cannot find module '"+u+"'");throw c.code="MODULE_NOT_FOUND",c}var l=e[u]={exports:{}};t[u][0].call(l.exports,function(n){var e=t[u][1][n];return r(e?e:n)},l,l.exports,n,t,e,o)}return e[u].exports}for(var i="function"==typeof require&&require,u=0;u<o.length;u++)r(o[u]);return r}({1:[function(n,t,e){var o;o=jQuery,o.fn.highlight=function(){return o(this).each(function(){var n;return n=o(this),o("<div/>").width(n.outerWidth()).height(n.outerHeight()).css({position:"absolute",left:n.offset().left,top:n.offset().top,"background-color":"#ffff77",opacity:.7,"z-index":10}).appendTo("body").fadeOut(1e3).queue(function(){return o(this).remove()})})}},{}],2:[function(n,t,e){var o,r,i,u,a,s,c,l,f,p;o=jQuery,l=n("aye-aye/lib/games/bin-tic-tac-toe"),a=l.X,r=l.O,s=l.decode,u=n("aye-aye/lib/games/ultimate-tic-tac-toe").UltimateTicTacToe,f=n("./spinner"),p=f.showSpinner,c=f.hideSpinner,n("./highlight"),i=n("./web-rtc").RTC,window.RTC=i,o(function(){var n,t,e,l,f,h,d,y,g,m,v,w,C,x,b,T,S,O;return f=null,x=null,w=null,d=null,l=function(){return h()},e=function(){return t()},g=function(){var n;return O(),y(),n=f.nextPlayer===a?x:w,n.play()},v=function(){var n,t,e,r,i,u,s;for(n=f.nextPlayer===a?"x-playable-tile":"o-playable-tile",u=f.possibleActions(),r=0,i=u.length;i>r;r++)s=u[r],t=s[0],e=s[1],o("#"+t+"\\,"+e).addClass(n);return n},O=function(){return o(".tile").removeClass("x-playable-tile").removeClass("o-playable-tile").removeClass("human-playable-tile").off("click")},y=function(){var n,t,e,r,i,u,s,c,l;for(s=[],n=e=0;9>e;n=++e){for(c=null,u=f.winOn(n),r=0,i=u.length;i>r;r++)t=u[r],c=f.at(n,t),l=c===a?"x-won-tile":"o-won-tile",o("#"+n+"\\,"+t).addClass(l);null!=c?(l=c===a?"x-won-board":"o-won-board",s.push(o("#"+n).addClass(l))):s.push(void 0)}return s},n=function(){return f.isTerminal()?(o("#info").text(function(){switch(!1){case!f.isWin(a):return"X Wins!";case!f.isWin(r):return"O Wins!";default:return"Draw!"}}()),!0):!1},C=function(){return s(f.nextPlayer).toLowerCase()},m=function(n){var t,e;return t=n[0],e=n[1],c(),o("#"+t+"\\,"+e).text(C()).highlight(),f=f.play(n),d=n,g()},h=function(){var t,e;return t=function(n){return parseInt(n,10)},e=function(n){var e;return e=n.match(/(\d),(\d)/),[t(e[1]),t(e[2])]},{setup:function(n){return n()},play:function(){var t;if(!n())return t=v(),o("."+t).addClass("human-playable-tile").on("click",function(){var n,t;return n=o(this),t=e(n.get(0).id),m(t)})},toString:function(){return"human"}}},t=function(t){var e;return null==t&&(t=3),e=new Worker("scripts/minimax-worker.min.js"),{setup:function(n){return e.onmessage=function(n){return m(n.data.action)},e.postMessage({command:"setup",args:{depth:t}}),n()},play:function(){return n()?void 0:(v(),p(),e.postMessage({command:"play",args:{lastAction:d}}))},teardown:function(){return e.terminate()},toString:function(){return"computer"}}},i.greet(),i.ondatachannelopen=function(){return i.I_am_a_host?(l=function(){return h()},e=function(){return b()}):(l=function(){return b()},e=function(){return h()}),T()},b=function(){var t;return t=function(){return i.send_message("new")},o("#btn-new-game").on("click",t),i.onmessage=function(n){return"new"===n?T():m(n)},{setup:function(n){return n()},play:function(){return n()||(v(),p()),null!=d?i.send_message(d):void 0},teardown:function(){return o("#btn-new-game").off("click",t)},toString:function(){return"remote"}}},T=function(){var n,t;return S(),f=new u,d=null,n=[l(),e()],x=n[0],w=n[1],t=[e,l],l=t[0],e=t[1],o("#info").text(x+" vs "+w),x.setup(function(){return w.setup(function(){return g()})})},S=function(){return null!=x&&"function"==typeof x.teardown&&x.teardown(),null!=w&&"function"==typeof w.teardown&&w.teardown(),c(),o(".tic-tac-toe").removeClass("x-won-board").removeClass("o-won-board"),o(".tile").removeClass("x-won-tile").removeClass("o-won-tile").text("")},o("#btn-new-game").on("click",T),T()})},{"./highlight":1,"./spinner":3,"./web-rtc":4,"aye-aye/lib/games/bin-tic-tac-toe":5,"aye-aye/lib/games/ultimate-tic-tac-toe":6}],3:[function(n,t,e){var o,r,i,u,a,s;o=jQuery,u=new Spinner({lines:9,radius:7,length:7}),s=null,a=100,i=function(){var n;return null==s?(n=o("#spinner").get(0),s=setTimeout(function(){return u.spin(n)},a)):void 0},r=function(){return null!=s&&clearTimeout(s),u.stop(),s=null},t.exports={showSpinner:i,hideSpinner:r}},{}],4:[function(n,t,e){var o,r,i,u,a,s,c,l,f,p;u=window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection||window.msRTCPeerConnection,a=window.RTCSessionDescription||window.mozRTCSessionDescription||window.webkitRTCSessionDescription||window.msRTCSessionDescription,c={iceServers:[{url:"stun:23.21.150.121"}]},l={optional:[{DtlsSrtpKeyAgreement:!0}]},r=function(){function n(){this.peerConnection=new u(c,l),this.dataChannel=null,this.peerConnection.onicecandidate=function(n){return function(t){return null===t.candidate?n.onoffercreated(JSON.stringify(n.peerConnection.localDescription)):void 0}}(this)}return n.prototype.setupDataChannel=function(){return this.dataChannel=this.peerConnection.createDataChannel("data",{reliable:!0}),this.dataChannel.onopen=function(n){return function(){return n.onchannelopen()}}(this),this.dataChannel.onmessage=function(n){return function(t){return n.onmessage(JSON.parse(t.data))}}(this)},n.prototype.createOffer=function(){return this.setupDataChannel(),this.peerConnection.createOffer(function(n){return function(t){return n.peerConnection.setLocalDescription(t)}}(this),function(){return console.warn("Couldn't create offer")})},n.prototype.acceptAnswer=function(n){return this.peerConnection.setRemoteDescription(new a(JSON.parse(n)))},n.prototype.send=function(n){return this.dataChannel.send(JSON.stringify(n))},n}(),o=function(){function n(){this.peerConnection=new u(c,l),this.dataChannel=null,this.peerConnection.onicecandidate=function(n){return function(t){return null===t.candidate?n.onanswercreated(JSON.stringify(n.peerConnection.localDescription)):void 0}}(this),this.peerConnection.ondatachannel=function(n){return function(t){return n.dataChannel=t.channel||t,n.dataChannel.onopen=function(){return n.onchannelopen()},n.dataChannel.onmessage=function(t){return n.onmessage(JSON.parse(t.data))}}}(this)}return n.prototype.offer=function(n){return this.peerConnection.setRemoteDescription(new a(JSON.parse(n))),this.peerConnection.createAnswer(function(n){return function(t){return n.peerConnection.setLocalDescription(t)}}(this),function(){return console.warn("Couldn't create answer")})},n.prototype.send=function(n){return this.dataChannel.send(JSON.stringify(n))},n}(),t.exports={Host:r,Guest:o},s="background: #222; color: #bada55",p=new r,p.onoffercreated=function(n){return console.log("%c"+JSON.stringify(n),s),console.log("HOST: offer created (above), give it to your GUEST, get his answer and call: %cRTC.accept_answer(answer)",s)},p.onchannelopen=function(){return console.clear(),console.log("HOST: data channel open"),"function"==typeof i.ondatachannelopen?i.ondatachannelopen():void 0},p.onmessage=function(n){return console.log("HOST: got data",n),"function"==typeof i.onmessage?i.onmessage(n):void 0},f=new o,f.onanswercreated=function(n){return console.log("%c"+JSON.stringify(n),s),console.log("GUEST: answer created (above), give it to your HOST")},f.onchannelopen=function(){return console.clear(),console.log("GUEST: data channel open"),"function"==typeof i.ondatachannelopen?i.ondatachannelopen():void 0},f.onmessage=function(n){return console.log("GUEST: got data",n),"function"==typeof i.onmessage?i.onmessage(n):void 0},i={be_a_host:function(){return this.I_am_a_host=!0,p.createOffer(),console.info("wait...")},accept_answer:function(n){return p.acceptAnswer(n)},be_a_guest:function(){return this.I_am_a_guest=!0,console.log("GUEST: get an offer from your HOST and call: %cRTC.receive_offer(offer)",s)},receive_offer:function(n){return f.offer(n),console.info("wait...")},send_message:function(n){return this.I_am_a_host?p.send(n):f.send(n)},greet:function(){return console.log("To play with a remote peer, start a match with %cRTC.be_a_host()",s),console.log("or accept a challenge with %cRTC.be_a_guest()",s)}},t.exports.RTC=i},{}],5:[function(n,t,e){var o,r,i,u,a,s,c,l,f,p,h,d,y,g,m,v,w,C,x,b,T,S,O,_,P,A,M,N,D,R,W,k=[].slice;A=n("../minimax"),r=A.MAX,i=A.MIN,M=[0,1,2],s=M[0],a=M[1],u=M[2],_=function(n){return 3&~n},d=function(n){return{0:" ",1:"X",2:"O"}[n]||function(){throw new Error(n)}()},m=0,f=function(n){var t,e,o,r,i;for(i=0,e=o=0,r=n.length;r>o;e=++o)t=n[e],i|=t<<2*e;return i},l=function(n,t){return n>>2*t&3},N=function(n){return[[l(n,0),l(n,1),l(n,2)],[l(n,3),l(n,4),l(n,5)],[l(n,6),l(n,7),l(n,8)]]},h=function(n){return[[l(n,0),l(n,3),l(n,6)],[l(n,1),l(n,4),l(n,7)],[l(n,2),l(n,5),l(n,8)]]},y=function(n){return[[l(n,0),l(n,4),l(n,8)],[l(n,2),l(n,4),l(n,6)]]},T=function(n){return k.call(N(n)).concat(k.call(h(n)),k.call(y(n)))},C=function(n){var t,e;for(t=e=0;18>e;t=e+=2)if(0===(3<<t&n))return!1;return!0},S={1:[21,1344,86016,4161,16644,66576,65793,4368],2:[42,2688,172032,8322,33288,133152,131586,8736]},P=[[0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[2,4,6]],b=function(n,t){var e,o,r,i;for(i=S[t]||function(){throw new Error(t)}(),e=0,o=i.length;o>e;e++)if(r=i[e],(r&n)===r)return!0;return!1},R=function(n){var t;return t=function(t){var e,o,r,i,u;for(u=S[t],e=o=0,r=u.length;r>o;e=++o)if(i=u[e],(i&n)===i)return P[e];return null},t(a)||t(u)||[]},x=function(n){return C(n)||b(n,a)||b(n,u)},O=function(n){var t,e,o;for(o=[],t=e=0;9>e;t=++e)0===(3<<2*t&n)&&o.push(t);return o},c=function(n,t){var e,o,r;for(r=[],e=o=0;18>o;e=o+=2)0===(3<<e&n)&&r.push(t<<e|n);return r},p=function(n,t){var e,o;for(e=o=0;18>o;e=++o)if((3<<2*e&n)!==(3<<2*e&t))return e;return null},W=.1,g=function(n,t){return null==t&&(t=0),Math.pow(W,t)*D(n)},D=function(n){return b(n,a)?2e3:b(n,u)?-2e3:C(n)?0:v(n)},w={},v=function(n){var t,e,o,r,i,s,c,l,f,p,h;if(null!=w[n])return w[n];for(f=0,c=T(n),t=0,r=c.length;r>t;t++){for(o=c[t],l=[0,0],h=l[0],s=l[1],e=0,i=o.length;i>e;e++)p=o[e],p===a&&++h,p===u&&++s;(0===h||0===s)&&(f+=Math.pow(10,h)-Math.pow(10,s))}return w[n]=f},o=function(){function n(n,t,e){this.value=null!=n?n:m,this.nextPlayer=null!=t?t:a,this.depth=null!=e?e:0}return n.create=function(){var t,e;return t=arguments[0],e=2<=arguments.length?k.call(arguments,1):[],null==t&&(t=[s,s,s,s,s,s,s,s,s]),function(n,t,e){e.prototype=n.prototype;var o=new e,r=n.apply(o,t);return Object(r)===r?r:o}(n,[f(t)].concat(k.call(e)),function(){})},n.prototype.at=function(n){return l(this.value,n)},n.prototype.rows=function(){return N(this.value)},n.prototype.columns=function(){return h(this.value)},n.prototype.diagonals=function(){return y(this.value)},n.prototype.lines=function(){return T(this.value)},n.prototype.isFull=function(){return C(this.value)},n.prototype.isWin=function(n){return b(this.value,n)},n.prototype.winOn=function(){return R(this.value)},n.prototype.isTerminal=function(){return x(this.value)},n.prototype.nextAgent=function(){return this.nextPlayer===a?r:i},n.prototype.openPositions=function(){return O(this.value)},n.prototype.possibleActions=function(){return c(this.value,this.nextPlayer)},n.prototype.action=function(n){return this.nextPlayer<<2*n|this.value},n.prototype.positionForAction=function(n){return p(this.value,n)},n.prototype.play=function(n){return new this.constructor(n,this.opponent(),this.depth+1)},n.prototype.utility=function(){return D(this.value)},n.prototype.opponent=function(n){return null==n&&(n=this.nextPlayer),_(n)},n.prototype.toString=function(){var n,t;return function(){var e,o,r,i;for(r=this.rows(),i=[],e=0,o=r.length;o>e;e++)t=r[e],i.push("|"+function(){var e,o,r;for(r=[],e=0,o=t.length;o>e;e++)n=t[e],r.push(d(n));return r}().join("|")+"|");return i}.call(this).join("\n")},n}(),t.exports={_:s,X:a,O:u,opponent:_,decode:d,empty:m,bin:f,at:l,rows:N,columns:h,diagonals:y,lines:T,isFull:C,isWin:b,isTerminal:x,openPositions:O,allPlays:c,changedOn:p,winOn:R,discountedUtility:g,utility:D,evaluate:v,BinTicTacToe:o}},{"../minimax":7}],6:[function(n,t,e){var o,r,i,u,a,s,c,l,f,p,h,d,y,g,m,v,w,C,x,b,T,S,O,_,P,A,M,N,D=[].slice;O=n("../minimax"),r=O.MAX,i=O.MIN,_=n("./bin-tic-tac-toe"),c=_._,s=_.X,u=_.O,d=_.decode,v=_.empty,f=_.bin,l=_.at,P=_.rows,p=_.columns,y=_.diagonals,T=_.lines,x=_.isWin,N=_.winOn,C=_.isTerminal,w=_.evaluate,o=_.BinTicTacToe,m=v,M=[m,m,m,m,m,m,m,m,m],A=function(n){var t,e,o,r;for(r=[],t=e=0,o=9;o>e;t=e+=3)r.push(n.slice(t,t+3));return r},h=function(n){var t,e,o;for(o=[],t=e=0;3>e;t=++e)o.push([n[t],n[t+3],n[t+6]]);return o},g=function(n){return[[n[0],n[4],n[8]],[n[2],n[4],n[6]]]},S=function(n){return D.call(A(n)).concat(D.call(h(n)),D.call(g(n)))},b=function(n,t){var e,o,r,i;for(i=S(n),r=0,o=i.length;o>r;r++)if(e=i[r],e.every(function(n){return x(n,t)}))return!0;return!1},a=function(){function n(n,t,e,o){this.a=null!=n?n:M,this.nextPlayer=null!=t?t:s,this.lastPlayedPosition=null!=e?e:4,this.depth=null!=o?o:0}return n.prototype.at=function(n,t){return l(this.a[n],t)},n.prototype.rows=function(){return A(this.a)},n.prototype.columns=function(){return h(this.a)},n.prototype.diagonals=function(){return g(this.a)},n.prototype.lines=function(){return S(this.a)},n.prototype.isTerminal=function(){return 0===this.possibleActions().length||this.isWin(s)||this.isWin(u)},n.prototype.isWin=function(n){return b(this.a,n)},n.prototype.winOn=function(n){return N(this.a[n])},n.prototype.nextAgent=function(){return this.nextPlayer===s?r:i},n.prototype.opponent=function(n){return null==n&&(n=this.nextPlayer),n===s?u:s},n.prototype.boardsForNextPlay=function(){var n,t,e,o,r,i;if(i=null!=this.lastPlayedPosition?this.a[this.lastPlayedPosition]:null,null==i||C(i)){for(r=[],o=this.a,n=e=0,t=o.length;t>e;n=++e)i=o[n],C(i)||r.push(n);return r}return[this.lastPlayedPosition]},n.prototype.openPositions=function(){var n,t,e,o,r,i,u,a,s;for(a=[],u=this.boardsForNextPlay(),r=0,o=u.length;o>r;r++){for(n=u[r],s=this.a[n],e=[],t=i=0;18>i;t=i+=2)0===(3<<t&s)&&e.push(t/2);a.push([n,e])}return a},n.prototype.action=function(n){return n},n.prototype.possibleActions=function(){var n,t,e,o,r,i,u,a,s,c;if(null!=this.actions)return this.actions;for(c=[],a=this.openPositions(),i=0,o=a.length;o>i;i++)for(s=a[i],n=s[0],e=s[1],u=0,r=e.length;r>u;u++)t=e[u],c.push([n,t]);return this.actions=c},n.prototype.play=function(n){var t,e,o;return e=n[0],o=n[1],t=this.a.slice(),t[e]=this.nextPlayer<<2*o|t[e],new this.constructor(t,this.opponent(),o,this.depth+1)},n.prototype.positionForAction=function(n){return n},n.prototype.utility=function(){var n,t,e,o,r,i,a,c,l,f,p,h;for(p=0,l=S(this.a),a=0,r=l.length;r>a;a++){for(o=l[a],f=[0,0,0],n=f[0],t=f[1],e=f[2],c=0,i=o.length;i>c;c++)h=o[c],x(h,s)?++n:x(h,u)&&++t,e+=w(h);(0===n||0===t)&&(p+=Math.pow(1e3,n)-Math.pow(1e3,t)),p+=e}return p},n.prototype.toString=function(){var n,t,e,o,r,i,u,a;for(r="",n=t=0;2>=t;n=++t){for(a=this.rows()[n],o=e=0;2>=e;o=++e)i=function(){var n,t,e;for(e=[],t=0,n=a.length;n>t;t++)u=a[t],e.push("|"+function(){var n,t,e,r;for(e=P(u)[o],r=[],t=0,n=e.length;n>t;t++)m=e[t],r.push(d(m));return r}().join("|")+"|");return e}(),r+=i.join(" ║ "),(2>n||2>o)&&(r+="\n");2>n&&(r+="════════╬═════════╬════════\n")}return r},n}(),t.exports={_:c,X:s,O:u,bin:f,UltimateTicTacToe:a}},{"../minimax":7,"./bin-tic-tac-toe":5}],7:[function(n,t,e){var o,r,i,u;u=["MAX","MIN"],o=u[0],r=u[1],i=function(){function n(n){this.depth=null!=n?n:1/0,this.rootAgent=o}return n.prototype.nextAction=function(n){var t,e,o;return this.rootAgent=n.nextAgent(),o=this.minimax(n),t=o[0],e=o[1],e},n.prototype.minimax=function(n,t,e,r){var i;return null==t&&(t=-(1/0)),null==e&&(e=+(1/0)),null==r&&(r=0),i=n.isTerminal(),i||n.nextAgent()!==this.rootAgent||++r,r>this.depth||i?[n.utility(),null]:n.nextAgent()===o?this.maxi(n,t,e,r):this.mini(n,t,e,r)},n.prototype.maxi=function(n,t,e,o){var r,i,u,a,s,c,l,f,p,h,d,y;for(l=[-(1/0),null],y=l[0],i=l[1],f=n.possibleActions(),a=0,s=f.length;s>a;a++){if(u=f[a],d=n.play(u),p=this.minimax(d,t,e,o),c=p[0],r=p[1],c>y&&(h=[c,u],y=h[0],i=h[1]),y>=e)return[y,i];t=Math.max(t,y)}return[y,i]},n.prototype.mini=function(n,t,e,o){var r,i,u,a,s,c,l,f,p,h,d,y;for(l=[+(1/0),null],y=l[0],i=l[1],f=n.possibleActions(),a=0,s=f.length;s>a;a++){if(u=f[a],d=n.play(u),p=this.minimax(d,t,e,o),c=p[0],r=p[1],y>c&&(h=[c,u],y=h[0],i=h[1]),t>=y)return[y,i];e=Math.min(e,y)}return[y,i]},n}(),t.exports={MAX:o,MIN:r,MinimaxAgent:i}},{}]},{},[2]);
//# sourceMappingURL=main.min.js.map
